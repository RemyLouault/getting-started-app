###name: build-docker
###on: [push]
###jobs: 
  ###build-docker-image:
    ###runs-on: ubuntu-latest
    ###steps:
      ###- run: ls

  ###- checkout code
  ###- ls
  ###- docker build
  ###- docker images
  ###- docker push
  ###{pas de credentials en clair}

            - name: Docker Login
  # You may pin to the exact commit or the version.
  # uses: docker/login-action@9780b0c442fbb1117ed29e0efdff1e18412f7567
  uses: docker/login-action@v3.3.0
  with:
    # Server address of Docker registry. If not set then will default to Docker Hub
    registry: # optional
    # Username used to log against the Docker registry
    username: # optional
    # Password or personal access token used to log against the Docker registry
    password: # optional
    # Specifies whether the given registry is ECR (auto, true or false)
    ecr: # optional, default is auto
    # Log out from the Docker registry at the end of a job
    logout: # optional, default is true

          
name: build-docker
on: [push]

jobs: 
  build-docker-image:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: List files
        run: ls -la

      - name: Build Docker image
        run: docker build -t my-image:latest .

      - name: List Docker images
        run: docker images

      - name: Login to DockerHub
        run: echo "${{ secrets.DOCKER_PASSWORD }}" | docker login -u "${{ secrets.DOCKER_USERNAME }}" --password-stdin

      - name: Push Docker image
        run: docker push my-image:latest
